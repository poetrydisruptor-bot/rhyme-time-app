<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RhymeTime - Poetry Learning App</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8fafc;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
        }
        
        .title { font-size: 3rem; font-weight: bold; margin-bottom: 0.5rem; }
        .subtitle { font-size: 1.2rem; opacity: 0.9; }
        
        .nav {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-buttons { display: flex; gap: 1rem; flex-wrap: wrap; }
        
        .nav-btn {
            background: white;
            color: #6b7280;
            border: 1px solid #e5e7eb;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .nav-btn:hover { color: #2563eb; border-color: #2563eb; }
        .nav-btn.active { background: #2563eb; color: white; }
        
        .premium-badge {
            background: #f59e0b;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 5px;
        }
        
        .upgrade-btn {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        
        .upgrade-btn:hover { background: #d97706; }
        
        .content { padding: 2rem; max-width: 800px; margin: 0 auto; }
        
        .section { display: none; }
        .section.active { display: block; }
        
        .page-title { font-size: 2rem; text-align: center; margin-bottom: 1rem; }
        .page-subtitle { text-align: center; color: #6b7280; margin-bottom: 2rem; }
        
        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .card h3 { font-size: 1.3rem; margin-bottom: 1rem; }
        .card p { color: #6b7280; margin-bottom: 1rem; }
        
        .poem-example {
            background: #f8fafc;
            border-left: 4px solid #2563eb;
            padding: 1rem;
            margin: 1rem 0;
            font-style: italic;
            border-radius: 4px;
        }
        
        .tip-box {
            background: #ecfdf5;
            border: 1px solid #10b981;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        
        .tip-title { color: #10b981; font-weight: bold; margin-bottom: 0.5rem; }
        
        .textarea {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
        }
        
        .textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        .btn:hover { background: #1d4ed8; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .btn-premium { background: #f59e0b; }
        .btn-premium:hover { background: #d97706; }
        
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            border-left: 4px solid;
        }
        
        .alert-success { background: #ecfdf5; border-color: #10b981; color: #065f46; }
        .alert-error { background: #fef2f2; border-color: #ef4444; color: #991b1b; }
        .alert-premium { background: #fffbeb; border-color: #f59e0b; color: #92400e; }
        
        .premium-locked {
            opacity: 0.6;
            position: relative;
        }
        
        .premium-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .lock-icon { font-size: 3rem; margin-bottom: 1rem; }
        
        .poem-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .poem-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .poem-date { font-size: 12px; color: #6b7280; }
        .poem-content { font-style: italic; line-height: 1.6; white-space: pre-wrap; }
        
        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 10px; right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }
        
        .pricing-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
        }
        
        .pricing-card.popular { border-color: #f59e0b; }
        .price { font-size: 2rem; font-weight: bold; margin: 1rem 0; }
        .price-period { font-size: 1rem; font-weight: normal; color: #6b7280; }
        
        /* Hide premium badges when premium is active */
        body.premium .premium-badge { display: none; }
        
        @media (max-width: 768px) {
            .nav { flex-direction: column; gap: 1rem; }
            .nav-buttons { justify-content: center; }
            .title { font-size: 2rem; }
            .content { padding: 1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">RhymeTime</h1>
            <p class="subtitle">Master the Art of AABB Poetry</p>
        </div>

        <div class="nav">
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showSection('home')">Home</button>
                <button class="nav-btn" onclick="showSection('lessons')">Lessons</button>
                <button class="nav-btn" onclick="showSection('practice')">Practice</button>
                <button class="nav-btn" onclick="showSection('nurse-verse')">
                    Nurse Verse <span class="premium-badge">Premium</span>
                </button>
                <button class="nav-btn" onclick="showSection('my-poems')">My Collection</button>
            </div>
            <div>
                <span id="status">Free Account</span>
                <button class="upgrade-btn" onclick="showPricing()">Upgrade</button>
            </div>
        </div>

        <div class="content">
            <div id="alerts"></div>

            <!-- Home -->
            <div id="home" class="section active">
                <h2 class="page-title">Welcome to RhymeTime</h2>
                <p class="page-subtitle">Learn AABB rhyming poetry step by step</p>
                
                <div class="card">
                    <h3>What You'll Learn</h3>
                    <ul>
                        <li>Perfect AABB rhyme schemes</li>
                        <li>Express any topic with confidence</li>
                        <li><strong>Premium:</strong> Healthcare poetry (Nurse Verse)</li>
                        <li><strong>Premium:</strong> Advanced lessons & unlimited storage</li>
                    </ul>
                    <button class="btn btn-premium" onclick="showPricing()">üöÄ Get Premium</button>
                </div>

                <div class="poem-example">
                    <strong>Sample AABB Poem:</strong><br><br>
                    The morning sun begins to rise,<br>
                    And paints the clouds across the skies.<br>
                    A brand new day is here at last,<br>
                    Let worries from yesterday pass.
                </div>

                <div class="tip-box">
                    <div class="tip-title">üí° AABB Explained</div>
                    <p>Lines 1&2 rhyme together, lines 3&4 rhyme together. Build poetry in perfect pairs!</p>
                </div>
            </div>

            <!-- Lessons -->
            <div id="lessons" class="section">
                <h2 class="page-title">Poetry Lessons</h2>
                
                <div class="card">
                    <h3>Lesson 1: Your First Couplet</h3>
                    <p>Write two lines that rhyme. Start simple!</p>
                    
                    <div class="poem-example">
                        <strong>Example:</strong><br>
                        I see a cup upon my desk,<br>
                        My workspace looking quite a mess.
                    </div>

                    <textarea id="lesson1" class="textarea" placeholder="Write your two-line poem here..."></textarea>
                    
                    <button class="btn" onclick="checkPoem('lesson1')">Check My Rhyme</button>
                    <button class="btn btn-success" onclick="savePoem('lesson1')">Save Poem</button>
                </div>

                <div class="card premium-locked">
                    <div class="premium-overlay">
                        <div class="lock-icon">üîí</div>
                        <h3>Premium Lessons</h3>
                        <p>Unlock advanced AABB training</p>
                        <button class="btn btn-premium" onclick="showPricing()">Upgrade</button>
                    </div>
                    <h3>Lesson 2: Four-Line AABB</h3>
                    <p>Premium lesson content...</p>
                </div>
            </div>

            <!-- Practice -->
            <div id="practice" class="section">
                <h2 class="page-title">Practice Zone</h2>
                
                <div class="card">
                    <h3>Free Writing</h3>
                    <p>Write about anything using AABB rhyme scheme.</p>
                    
                    <textarea id="practice-text" class="textarea" placeholder="Let your creativity flow..."></textarea>
                    
                    <button class="btn btn-success" onclick="savePoem('practice-text')">Save Poem</button>
                    <button class="btn" onclick="clearText('practice-text')">Clear</button>
                </div>
            </div>

            <!-- Nurse Verse -->
            <div id="nurse-verse" class="section">
                <div class="card premium-locked">
                    <div class="premium-overlay">
                        <div class="lock-icon">üîí</div>
                        <h3>Unlock Nurse Verse</h3>
                        <p>Healthcare poetry features</p>
                        <button class="btn btn-premium" onclick="showPricing()">Upgrade</button>
                    </div>
                    <h2 class="page-title">Nurse Verse</h2>
                    <p class="page-subtitle">Healthcare poetry for everyone</p>
                    
                    <div class="poem-example">
                        <strong>"The Gentle Healer":</strong><br><br>
                        She walks the halls with caring grace,<br>
                        A healing smile upon her face.<br>
                        Through long night shifts she tends with care,<br>
                        For those who need her to be there.
                    </div>
                </div>
            </div>

            <!-- My Poems -->
            <div id="my-poems" class="section">
                <h2 class="page-title">My Poetry Collection</h2>
                
                <div class="card">
                    <h3>Saved Poems</h3>
                    <div id="poems-list">
                        <p style="text-align: center; color: #6b7280; font-style: italic;">
                            Your poems will appear here
                        </p>
                    </div>
                </div>

                <div class="card">
                    <h3>Manage Collection</h3>
                    <button class="btn" onclick="exportPoems()">üì• Download</button>
                    <button class="btn" onclick="clearAllPoems()">üóëÔ∏è Clear All</button>
                    <button class="btn" onclick="debugStripe()" style="background: #6b7280;">üîß Debug Payments</button>
                    <button class="btn" onclick="forcePremium()" style="background: #10b981;">‚úÖ Test Premium</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pricing Modal -->
    <div id="pricing-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="hidePricing()">&times;</button>
            <h2 style="text-align: center; margin-bottom: 1rem;">Choose Your Plan</h2>
            
            <div class="pricing-card">
                <h3>Monthly</h3>
                <div class="price">$12.99<span class="price-period">/month</span></div>
                <ul style="text-align: left;">
                    <li>‚úì All lessons</li>
                    <li>‚úì Unlimited storage</li>
                    <li>‚úì Nurse Verse access</li>
                    <li>‚úì Export feature</li>
                </ul>
                <button class="btn btn-premium" onclick="buyPlan('monthly')" style="width: 100%;">
                    Buy Monthly Plan
                </button>
            </div>
            
            <div class="pricing-card popular">
                <h3>Annual (Best Value)</h3>
                <div class="price">$99.99<span class="price-period">/year</span></div>
                <p style="color: #10b981; font-weight: bold;">Save $56!</p>
                <ul style="text-align: left;">
                    <li>‚úì All monthly features</li>
                    <li>‚úì Priority support</li>
                    <li>‚úì Early access</li>
                </ul>
                <button class="btn btn-premium" onclick="buyPlan('annual')" style="width: 100%;">
                    Buy Annual Plan
                </button>
            </div>
        </div>
    </div>

    <script>
        // GLOBAL VARIABLES
        var poems = [];
        var isPremium = false;
        
        // Replace with your actual Stripe keys and price IDs
        const MONTHLY_LINK = "https://buy.stripe.com/fZufZg8Zr0UX2t24F81VK01";
        const ANNUAL_LINK  = "https://buy.stripe.com/8x27sKejL1Z16Ji1sW1VK00";

        // BASIC FUNCTIONS
        function showSection(id) {
            var sections = document.querySelectorAll('.section');
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }
            
            var buttons = document.querySelectorAll('.nav-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');

            if (id === 'my-poems') {
                showPoems();
            }
        }

        function showAlert(message, type) {
            var alerts = document.getElementById('alerts');
            alerts.innerHTML = '<div class="alert alert-' + type + '">' + message + '</div>';
            setTimeout(function() {
                alerts.innerHTML = '';
            }, 4000);
        }

        function checkPoem(id) {
            var text = document.getElementById(id).value.trim();
            if (text.length < 10) {
                showAlert('Keep writing! Add more content.', 'error');
                return;
            }
            
            var lines = text.split('\n').filter(function(line) {
                return line.trim().length > 0;
            });
            
            if (lines.length >= 2) {
                showAlert('Great work! üéâ You are mastering AABB!', 'success');
            } else {
                showAlert('Try writing at least two lines.', 'error');
            }
        }

        function savePoem(id) {
            var text = document.getElementById(id).value.trim();
            if (text.length < 10) {
                showAlert('Write more before saving!', 'error');
                return;
            }
            
            var poem = {
                content: text,
                date: new Date().toLocaleDateString(),
                id: Date.now()
            };
            
            poems.push(poem);
            localStorage.setItem('rhymeTimePoems', JSON.stringify(poems));
            showAlert('Poem saved! üìù', 'success');
            document.getElementById(id).value = '';
        }

        function clearText(id) {
            if (confirm('Clear your writing?')) {
                document.getElementById(id).value = '';
            }
        }

        function showPoems() {
            var container = document.getElementById('poems-list');
            if (poems.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280; font-style: italic;">Your poems will appear here</p>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < poems.length; i++) {
                var poem = poems[i];
                html += '<div class="poem-card">' +
                    '<div class="poem-meta">' +
                    '<span class="poem-date">' + poem.date + '</span>' +
                    '<button class="delete-btn" onclick="deletePoem(' + i + ')">Delete</button>' +
                    '</div>' +
                    '<div class="poem-content">' + poem.content + '</div>' +
                    '</div>';
            }
            container.innerHTML = html;
        }

        function deletePoem(index) {
            if (confirm('Delete this poem?')) {
                poems.splice(index, 1);
                localStorage.setItem('rhymeTimePoems', JSON.stringify(poems));
                showPoems();
                showAlert('Poem deleted', 'success');
            }
        }

        function exportPoems() {
            if (poems.length === 0) {
                showAlert('No poems to export!', 'error');
                return;
            }
            
            var content = 'My RhymeTime Poems\n\n';
            for (var i = 0; i < poems.length; i++) {
                content += poems[i].date + '\n' + poems[i].content + '\n\n---\n\n';
            }
            
            var blob = new Blob([content], { type: 'text/plain' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'my-poems.txt';
            a.click();
            URL.revokeObjectURL(url);
            showAlert('Downloaded! üì•', 'success');
        }

        function clearAllPoems() {
            if (confirm('Delete all poems?')) {
                poems = [];
                localStorage.removeItem('rhymeTimePoems');
                showPoems();
                showAlert('All poems cleared', 'success');
            }
        }

        // PREMIUM FUNCTIONS
        function showPricing() {
            document.getElementById('pricing-modal').classList.add('show');
        }

        function hidePricing() {
            document.getElementById('pricing-modal').classList.remove('show');
        }

        // Payment Links checkout (no Stripe.js, no secret keys)
        function buyPlan(plan) {
            const url = plan === 'annual' ? ANNUAL_LINK : MONTHLY_LINK;

            if (!url || !url.includes("buy.stripe.com")) {
                showAlert('‚ùå Payment Link not set. Please paste your Stripe link in the code.', 'error');
                return;
            }

            showAlert('üîÑ Redirecting to secure checkout‚Ä¶', 'success');
            window.location.href = url;
        }

        function activatePremium() {
            console.log('üîß Activating Premium...');
            
            // Save premium status
            localStorage.setItem('rhymeTimePremium', 'true');
            isPremium = true;

            // Update status text
            const plan = localStorage.getItem('rhymeTimePlan') || 'monthly';
            const status = document.getElementById('status');
            if (status) {
                status.textContent = `Premium Member (${plan})`;
            }

            // Add premium class to body for global styling
            document.body.classList.add('premium');

            // Remove all premium locks and overlays
            document.querySelectorAll('.premium-locked').forEach(el => {
                el.classList.remove('premium-locked');
                console.log('üîì Unlocked:', el);
            });
            
            document.querySelectorAll('.premium-overlay').forEach(el => {
                el.style.display = 'none';
                console.log('üëª Hidden overlay:', el);
            });

            // Hide upgrade buttons
            document.querySelectorAll('.upgrade-btn, .btn-premium').forEach(el => {
                if (el.textContent.includes('Get Premium') || el.textContent.includes('Upgrade')) {
                    el.style.display = 'none';
                    console.log('üö´ Hidden upgrade button:', el);
                }
            });

            console.log('‚úÖ Premium activation complete!');
            showAlert('üéâ Premium features unlocked!', 'success');
        }

        function checkPremiumStatus() {
            return localStorage.getItem('rhymeTimePremium') === 'true';
        }

        function checkPayment() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Check for multiple possible success indicators
            const hasSuccess = urlParams.get('success') === 'true' || 
                              urlParams.get('payment_success') === 'true' ||
                              urlParams.get('session_id') || 
                              urlParams.get('checkout_success') === 'true';

            if (hasSuccess) {
                console.log('üí≥ Payment success detected!');
                
                const plan = urlParams.get('plan') || urlParams.get('price_id') || 'monthly';
                
                // Save premium status
                localStorage.setItem('rhymeTimePremium', 'true');
                localStorage.setItem('rhymeTimePlan', plan.toLowerCase());

                // Activate premium immediately
                activatePremium();
                
                // Clean URL to remove payment parameters
                if (window.history && window.history.replaceState) {
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
                
                showAlert(`üéâ Welcome to Premium! (${plan} plan)`, 'success');
            }
        }

        function loadData() {
            try {
                // Load saved poems
                var saved = localStorage.getItem('rhymeTimePoems');
                if (saved) poems = JSON.parse(saved);

                // Check if user already has premium
                if (checkPremiumStatus()) {
                    console.log('üîç Existing premium status found');
                    activatePremium();
                }
            } catch (e) {
                console.error('Error loading data:', e);
                poems = [];
            }
        }

        function debugStripe() {
            const isPrem = localStorage.getItem('rhymeTimePremium');
            const plan = localStorage.getItem('rhymeTimePlan');
            const urlParams = new URLSearchParams(window.location.search);
            
            let debug = `Premium Status: ${isPrem}\n`;
            debug += `Plan: ${plan}\n`;
            debug += `URL Params: ${window.location.search}\n`;
            debug += `Body has premium class: ${document.body.classList.contains('premium')}`;
            
            alert(debug);
            console.log('üîß Debug Info:', {
                isPremium: isPrem,
                plan: plan,
                urlParams: Object.fromEntries(urlParams),
                bodyHasPremiumClass: document.body.classList.contains('premium')
            });
        }

        // Test function to manually activate premium
        function forcePremium() {
            if (confirm('Force activate premium for testing?')) {
                localStorage.setItem('rhymeTimePremium', 'true');
                localStorage.setItem('rhymeTimePlan', 'test');
                activatePremium();
            }
        }

        // Close pricing modal when clicking outside it
        window.onclick = function (event) {
            const modal = document.getElementById('pricing-modal');
            if (event.target === modal) hidePricing();
        };

        // Expose functions to global scope for inline onclick handlers
        window.showSection = showSection;
        window.showPricing = showPricing;
        window.hidePricing = hidePricing;
        window.buyPlan = buyPlan;
        window.checkPoem = checkPoem;
        window.savePoem = savePoem;
        window.clearText = clearText;
        window.deletePoem = deletePoem;
        window.exportPoems = exportPoems;
        window.clearAllPoems = clearAllPoems;
        window.debugStripe = debugStripe;
        window.forcePremium = forcePremium;

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üöÄ RhymeTime starting up...');
            checkPayment();  // Check for successful payment first
            loadData();      // Then load existing data
            console.log('‚úÖ RhymeTime ready!');
        });
    </script>
    <!-- your existing scripts -->
<script>
  /* ... your current JavaScript ... */
</script>

<!-- new Supabase login & premium check script -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script><script>
  const SUPABASE_URL = "https://yfabmhamqywczdruzjem.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmYWJtaGFtcXl3Y3pkcnV6amVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5NDAwNjUsImV4cCI6MjA3MDUxNjA2NX0.ePHEWI_3PCzNRdeDwAIqM2VJnIPAV28Q7ppX5hWTr5Y";

  // Supabase client (CDN exposes global `supabase`)
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // Call this after DOM is ready (you already have a DOMContentLoaded; calling here is safe too)
  initAuthAndPremium();

  async function initAuthAndPremium() {
    // 1) Check login
    const { data: { user } } = await sb.auth.getUser();

    if (!user) {
  console.log("Not logged in");
  // OPTIONAL: show a "Log in" button if you have one
  // document.getElementById('login-btn')?.classList.remove('hidden');
  return;
}

// DEBUG: make sure this matches the email in your Supabase subscriptions table
console.log("Supabase user object:", user);
console.log("Email to match in subscriptions table:", user.email);
    }

    // 2) Check subscriptions table for active sub
    const { data, error } = await sb
      .from('subscriptions')
      .select('status, plan')
      .eq('email', user.email)
      .eq('status', 'active')
      .maybeSingle();

    if (error) {
      console.warn('Sub lookup error:', error);
      return;
    }

    if (data) {
      // Persist + update UI using your existing functions
      localStorage.setItem('rhymeTimePremium', 'true');
      localStorage.setItem('rhymeTimePlan', data.plan || 'monthly');
      if (typeof activatePremium === 'function') activatePremium();
      // Hide any upgrade buttons
      document.querySelectorAll('#upgrade, .upgrade-btn, .upgrade, .upgrade-cta, [data-role="upgrade"]')
        .forEach(el => el.style.display = 'none');
      console.log('Premium unlocked from Supabase:', data.plan);
    } else {
      console.log('No active subscription for this user.');
    }
  }

  // SIMPLE LOGIN/LOGOUT (optional, only if you add buttons with these IDs)
  // Google OAuth (enable Google in Supabase Auth providers)
  window.loginWithGoogle = async () => {
    await sb.auth.signInWithOAuth({
      provider: 'google',
      options: { redirectTo: window.location.origin }
    });
  };

  window.logout = async () => {
    await sb.auth.signOut();
    localStorage.removeItem('rhymeTimePremium');
    localStorage.removeItem('rhymeTimePlan');
    window.location.reload();
  }
}

</script>
    <button onclick="loginWithGoogle()">Sign in with Google</button>

<script>
  function loginWithGoogle() {
    sb.auth.signInWithOAuth({
      provider: 'google',
      options: { redirectTo: window.location.origin }
    });
  }
</script>

</body>
</html>
